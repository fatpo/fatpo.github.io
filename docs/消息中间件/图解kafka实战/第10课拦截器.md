# 1、拦截器的作用
网上很多资料说了很多，其实国哥就四个字：`业务定制`。

# 2、拦截器是否可串行
可以，就像责任链一样，一环接一环。

# 3、拦截器的副作用
很多拦截器也正因是环环相扣，比如`A->B->C`，B依赖A，C依赖B，如果其中B出错了，那么链条就变成了`A->C`，这个时候业务就可能错了。

# 4、代码样例
## 4.1、两个拦截器
定制了两个拦截器：
```text
ProducerInterceptorPrefix1.class 
ProducerInterceptorPrefix2.class
```
拦截器1作用： [代码](https://github.com/fatpo/kafka-demo/blob/main/kakfa/src/main/java/ProducerInterceptorPrefix1.java)
```text
value 改为 prefix1-value
统计下发送消息的成功率、失败率
```

拦截器2作用： [代码](https://github.com/fatpo/kafka-demo/blob/main/kakfa/src/main/java/ProducerInterceptorPrefix2.java)

```text
value 改为 prefix2-value
统计下发送消息的成功率、失败率
```


## 4.2、生产者怎么配置拦截器
在生产者中配置这两个拦截器：
```java
 properties.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG,
            ProducerInterceptorPrefix1.class.getName() + "," + ProducerInterceptorPrefix2.class.getName());
```
小技巧就是，两个拦截器用逗号分割，先遇到的拦截器先处理。

较为完整的配置：
```java
public static Properties initConfig() {
    Properties properties = new Properties();
    // 诸如“key.serializer”、“max.request.size”、“interceptor.classes”之类的字符串经常由于人为因素而书写错误
    // kafka 帮我们提供了一些constant常量
    properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, brokerList);
    properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,
            "org.apache.kafka.common.serialization.StringSerializer");
    properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,
            "org.apache.kafka.common.serialization.StringSerializer");
    properties.put(ProducerConfig.CLIENT_ID_CONFIG, "producer.client.id.demo");
    properties.put(ProducerConfig.RETRIES_CONFIG, 10);
    properties.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG,
            ProducerInterceptorPrefix1.class.getName() + "," + ProducerInterceptorPrefix2.class.getName());
    return properties;
}
```
生产者`异步`发了`两条`消息，结果显示：
```text     
[send callback -1] topic: test2, partition: 1, offset: 12
[send callback -2] topic: test2, partition: 3, offset: 16
interceptor1 send success:2, send failure:0
interceptor2 send success:2, send failure:0
```
消费者结果显示：
```text
prefix2-prefix1-hello, Kafka!
prefix2-prefix1-hello, Kafka!
```

[GIT完整代码](https://github.com/fatpo/kafka-demo/blob/main/kakfa/src/main/java/ProducerDemoV5Interceptor.java)