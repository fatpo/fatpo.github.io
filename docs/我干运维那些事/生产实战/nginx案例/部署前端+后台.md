# 背景

* 纯 http，不带 https

* 后台端口 8090，就一个实例

* web 前端的代码解压后放在: `/var/www/html/build/`

* 后台所有接口都是以 `myapi`开头

# 配置
配置如下 `vi /etc/nginx/conf/haha.conf`:
```text
upstream myapp{
    server 127.0.0.1:8090 weight=1;
}

server {
    listen      80;
    listen [::]:80;

    server_name  45.12.204.111;


    client_max_body_size 20m;

    location / {
        root   /var/www/html/build/;
        index  index.html index.htm;
    }

    location /myapi {
        proxy_set_header        REMOTE_ADDR     $proxy_add_x_forwarded_for;

        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT, X-Mx-ReqToken, Keep-Alive, User-Agent, X-Requested-With, If-Modified-Since, Cache-Control, Content-Type, Authorization';

        if ($request_method = 'OPTIONS') {
            return 204;
        }

        proxy_set_header   Host             $host:8090;
        proxy_set_header   X-Real-IP        $remote_addr;
        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        proxy_set_header   Cookies          $http_cookies;
        proxy_pass http://myapp;
    }
}
```

# 重启

检查配置是否生效:

```text
nginx -t
```

重启：

```text
nginx -s reload
```
